<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>信用认证</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<style>
			html,
			body {
				background: #FFF;
			}
			
			ul,
			li {
				margin: 0px;
				padding: 0px;
			}
			
			#progressbar {
				overflow: hidden;
				margin: 10px auto;
				/*CSS counters to number the steps*/
			}
			
			#progressbar li {
				list-style-type: none;
				width: 33.33%;
				float: left;
				font-size: 14px;
				position: relative;
			}
			
			#progressbar li:before {
				content: '';
				width: 30px;
				height: 30px;
				line-height: 30px;
				font-size: 11px;
				font-weight: bold;
				display: block;
				color: #3399ff;
				background: white;
				border: 1px #3399ff solid;
				border-radius: 100%;
				margin: 0 auto 1px auto;
			}
			
			#progressbar li:nth-child(2):before {
				content: '50%';
			}
			
			#progressbar li:nth-child(3):before {
				content: '100%';
			}
			/*progressbar connectors*/
			
			#progressbar li:after {
				content: '';
				width: 74%;
				height: 2px;
				background: #3399ff;
				position: absolute;
				left: -37%;
				top: 15px;
			}
			
			#progressbar li:first-child:after {
				content: none;
			}
			
			#progressbar li.active:before,
			#progressbar li.active:after {
				background: #3399ff;
			}
			
			.mui-content {
				background-color: #FFF;
			}
			
			.mui-input-row label {
				width: 38%;
			}
			
			.mui-input-row label~input {
				width: 62%;
			}
			
			.mui-input-group .mui-input-row {
				color: #8f8f94;
				font-size: 12px;
			}
			
			.mui-input-group .mui-input-row input {
				font-size: 12px;
			}
			
			::-webkit-input-placeholder {
				font-size: 12px;
			}
			
			.mui-btn {
				background: #3399ff;
				padding: 8px;
			}
			
			.list-img {
				width: 100%;
				height: 120px;
				background-size: cover;
				overflow: hidden;
			}
			
			.xs-div-card {
				border: 1px #8f8f94 dashed;
				border-radius: 5px;
				height: 80%;
				text-align: center;
				line-height: 100px;
				color: #FFB400;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">信用认证</h1>
		</header>
		<div class="mui-content">
			<!-- progressbar -->
			<div style="text-align: center;">
				<ul id="progressbar">
					<li class="active">联系方式</li>
					<li>身份认证</li>
					<li>信用认证</li>
				</ul>
			</div>
			<!-- step1 -->
			<div class="mui-content-padded" style="margin: 5px;">
				<p style="margin: 6px auto;">联系方式</p>
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>借款本人手机号：</label>
						<input id="inp_tel" type="text" class="mui-input-clear" placeholder="请输入手机号（必填）">
					</div>
					<div class="mui-input-row">
						<label>手机服务密码：</label>
						<input id="inp_telpwd" type="text" class="mui-input-clear" placeholder="手机服务密码（必填）">
					</div>
					<div class="mui-input-row">
						<label>支付宝帐号：</label>
						<input id="inp_alipay" type="text" class="mui-input-clear" placeholder="支付宝帐号（必填）">
					</div>
					<div class="mui-input-row">
						<label>联系QQ：</label>
						<input id="inp_qq" type="text" class="mui-input-clear" placeholder="请输入QQ号（必填）">
					</div>
				</form>
				<p style="margin: 6px auto;">关系人 <span id="relativeTelPicker" class="mui-icon mui-icon mui-icon-personadd"></span></p>
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>姓名：</label>
						<input id="inp_party" type="text" class="mui-input-clear" disabled placeholder="关系人姓名（必填）">
					</div>
					<div class="mui-input-row">
						<label>联系方式：</label>
						<input id="inp_partyTel" type="text" class="mui-input-clear" disabled placeholder="关系人手机号（必填）">
					</div>
				</form>
				<p style="margin: 6px auto;">常用联系人 <span id="contactsPicker" class="mui-icon mui-icon mui-icon-personadd"></span></p>
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>姓名：</label>
						<input id="inp_contacts" type="text" class="mui-input-clear" disabled placeholder="联系人姓名（必填）">
					</div>
					<div class="mui-input-row">
						<label>联系方式：</label>
						<input id="inp_contactsTel" type="text" class="mui-input-clear" disabled placeholder="联系人手机号（必填）">
					</div>
				</form>
				<div style="text-align: center;margin: 10px auto;font-size: 13px;color: #8f8f94;">请确认以上信息准确无误!</div>
				<button id="btn_step1" class="mui-btn mui-btn-block mui-btn-primary">下一步</button>
			</div>
			<!-- step2 -->
			<div class="mui-content-padded mui-hidden xs-div-step2" style="margin: 5px;">
				<p style="margin: 6px auto;">为完善您的资产安全，请如实填写</p>
				<div id="list-img" class="list-img">
					<div style="height: 100%;width: 45%;float: left;margin-left: 10px;">
						<div class="xs-div-card">
							点击上传
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>身份证正面照片</h5>
						</div>
					</div>
					<div style="height: 100%;width: 45%;float: right;margin-right: 10px;">
						<div style="background: url(../img/sfz-1.png);background-size: cover;height: 80%;width: 100%;">
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>照片范例</h5>
						</div>
					</div>
				</div>
				<div class="list-img" style="margin-top: 16px;">
					<div style="height: 100%;width: 45%;float: left;margin-left: 10px;">
						<div class="xs-div-card">
							点击上传
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>身份证反面照片</h5>
						</div>
					</div>
					<div style="height: 100%;width: 45%;float: right;margin-right: 10px;">
						<div style="background: url(../img/sfz-2.png);background-size: cover;height: 80%;width: 100%;">
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>照片范例</h5>
						</div>
					</div>
				</div>
				<div class="list-img" style="margin-top: 16px;margin-bottom: 20px;">
					<div style="height: 100%;width: 45%;float: left;margin-left: 10px;">
						<div class="xs-div-card">
							点击上传
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>手持身份证照片</h5>
						</div>
					</div>
					<div style="height: 100%;width: 45%;float: right;margin-right: 10px;">
						<div style="background: url(../img/sfz-3.png);background-size: cover;height: 80%;width: 100%;">
						</div>
						<div style="text-align: center;margin-top: 5px;">
							<h5>照片范例</h5>
						</div>
					</div>
				</div>
				<button id="btn_step2" class="mui-btn mui-btn-block mui-btn-primary">下一步</button>
			</div>
			<div class="mui-content-padded mui-hidden">
				信用认证：
				<button>完成</button>
			</div>
		</div>

		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: false //启用右滑关闭功能
			})
			mui.plusReady(function() {
				//通讯录
				var telPicker = new mui.PopPicker();
				//第一步操作
				document.getElementById('btn_step1').addEventListener('tap', function() {
					// var next_index = Array.prototype.indexOf.call(document.querySelectorAll('.div-step'),this.parentNode.nextElementSibling);
					if(validStep1Form()) {
						this.parentNode.classList.add('mui-hidden');
						this.parentNode.nextElementSibling.classList.remove('mui-hidden');
						document.querySelectorAll("#progressbar li")[1].classList.add('active');
					}
				});
				//第二步操作
				document.getElementById('btn_step2').addEventListener('tap', function() {
					this.parentNode.classList.add('mui-hidden');
					this.parentNode.nextElementSibling.classList.remove('mui-hidden');
					document.querySelectorAll("#progressbar li")[2].classList.add('active');
				});
				//添加关系人
				document.getElementById('relativeTelPicker').addEventListener('tap', function(event) {
					plus.contacts.getAddressBook(plus.contacts.ADDRESSBOOK_PHONE, function(addressbook) {
						var telArr = new Array();
						addressbook.find(["displayName", "phoneNumbers"], function(contacts) {
							for(var i = 0, n = contacts.length; i < n; i++) {
								var dataObj = new Object();
								dataObj.text = contacts[i].displayName;
								if(contacts[i].phoneNumbers.length > 0) {
									dataObj.value = contacts[i].phoneNumbers[0].value;
								}
								telArr[i] = dataObj;
							}
							telPicker.setData(telArr);
							telPicker.show(function(items) {
								if(!items[0]){
									document.getElementById('inp_party').value = items[0].text;
									document.getElementById('inp_partyTel').value = items[0].value;
								}
								//返回 false 可以阻止选择框的关闭
								//return false;
							});
						}, function() {
							alert("error");
						}, {
							multiple: true
						});
					}, function(e) {
						alert("Get address book failed: " + e.message);
					});
				}, true);
				//添加联系人
				document.getElementById('contactsPicker').addEventListener('tap', function(event) {
					plus.contacts.getAddressBook(plus.contacts.ADDRESSBOOK_PHONE, function(addressbook) {
						var telArr = new Array();
						addressbook.find(["displayName", "phoneNumbers"], function(contacts) {
							for(var i = 0, n = contacts.length; i < n; i++) {
								var dataObj = new Object();
								dataObj.text = contacts[i].displayName;
								if(contacts[i].phoneNumbers.length > 0) {
									dataObj.value = contacts[i].phoneNumbers[0].value;
								}
								telArr[i] = dataObj;
							}
							telPicker.setData(telArr);
							telPicker.show(function(items) {
								if(!items[0]){
									document.getElementById('inp_contacts').value = items[0].text;
									document.getElementById('inp_contactTel').value = items[0].value;
								}
								//返回 false 可以阻止选择框的关闭
								//return false;
							});
						}, function() {
							alert("error");
						}, {
							multiple: true
						});
					}, function(e) {
						alert("Get address book failed: " + e.message);
					});
				}, true);
				// 点击上传图片
				mui('.xs-div-step2').on('tap', '.list-img .xs-div-card', function() {
					var size = null;
					var self = this;
					plus.gallery.pick(function(e) {
						var name = e.substr(e.lastIndexOf('/') + 1);
						console.log("name:" + name);
						
						plus.zip.compressImage({
							src: e,
							dst: '_doc/' + name,
							overwrite: true,
							quality: 50
						}, function(zip) {
							size += zip.size
							console.log("filesize:" + zip.size + ",totalsize:" + size);
							if(size > (10 * 1024 * 1024)) {
								return mui.toast('文件超大,请重新选择');
							}
							self.innerHTML = '<img src="'+zip.target+'" style="width:100%;height:100%;" />'
						}, function(zipe) {
							mui.toast('压缩失败！')
						});
					}, function(e) {
						mui.toast(e.message);
					}, {
						filter: "image",
						multiple: false
					});
				});
			});
			/**
			 * step1表单验证 
			 */
			function validStep1Form() {
				if(document.getElementById("inp_tel").length != 11) {
					mui.toast("借款本人手机号不能为空");
					return false;
				}
				if(document.getElementById("inp_telpwd").length != 4) {
					mui.toast("手机服务密码不能为空");
					return false;
				}
				if(!document.getElementById('inp_alipay').value) {
					mui.toast("支付宝帐号不能为空");
					return false;
				}
				if(document.getElementById('inp_qq').value) {
					mui.toast("QQ号码不能为空");
					return false;
				}
				if(!document.getElementById('inp_party').value && !document.getElementById('inp_partyTel').value) {
					mui.toast("关系人不能为空");
					return false;
				}
				if(!document.getElementById('inp_contacts').value && !document.getElementById('inp_contactsTel').value) {
					mui.toast("常用联系人不能为空");
					return false;
				}
				return true;
			}
		</script>
	</body>

</html>